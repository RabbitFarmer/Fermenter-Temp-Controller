<!DOCTYPE html>
<html>
<head>
    <title>Kasa Plug Scan Results</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        h2 { color: #333; }
        ul { list-style-type: none; padding: 0; }
        li { padding: 0.5em 0; }
        .plug-alias { font-weight: bold; color: #2467a3; }
        .plug-ip { font-family: monospace; color: #444; }
        .error { color: red; margin-bottom: 1em; }
        .back-link { display: inline-block; margin-top: 2em; }
        .plug-actions { margin-left: 12px; }
        .plug-actions button { 
            padding: 4px 8px; 
            margin-left: 4px; 
            border: 1px solid #888; 
            background: #4CAF50; 
            color: white; 
            border-radius: 3px; 
            cursor: pointer; 
            font-size: 12px;
        }
        .plug-actions button:hover { 
            background: #45a049; 
        }
        .info-message {
            padding: 12px;
            background: #e7f3fe;
            border-left: 4px solid #2196F3;
            margin-bottom: 1em;
            font-size: 14px;
        }
        .success-message {
            padding: 12px;
            background: #d4edda;
            border-left: 4px solid #28a745;
            margin-bottom: 1em;
            font-size: 14px;
            display: none;
        }
    </style>
    <script>
        function setPlug(type, url) {
            // Store the URL in localStorage to be retrieved by temp_control_config page
            localStorage.setItem('kasa_' + type + '_url', url);
            
            // Show success message instead of alert
            const successMsg = document.getElementById('successMessage');
            const typeCapitalized = type.charAt(0).toUpperCase() + type.slice(1);
            successMsg.textContent = typeCapitalized + ' plug URL set to: ' + url + '. Click "Back to Temperature Control Config" to apply.';
            successMsg.style.display = 'block';
            
            // Scroll to success message
            successMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            // Hide message after 5 seconds
            setTimeout(function() {
                successMsg.style.display = 'none';
            }, 5000);
        }
    </script>
</head>
<body>
    <h2>Kasa Plugs Found:</h2>
    
    <div id="successMessage" class="success-message"></div>
    
    {% if error %}
        <div class="error">Error scanning: {{ error }}</div>
    {% endif %}
    {% if devices %}
        <div class="info-message">
            Click "Set as Heating" or "Set as Cooling" to populate the URL in the Temperature Control settings.
        </div>
        <ul>
        {% for ip, name in devices.items() %}
            <li>
                <span class="plug-alias">{{ name }}</span>
                <span class="plug-ip">({{ ip }})</span>
                <span class="plug-actions">
                    <button onclick="setPlug('heating', this.getAttribute('data-ip'))" data-ip="{{ ip }}">Set as Heating</button>
                    <button onclick="setPlug('cooling', this.getAttribute('data-ip'))" data-ip="{{ ip }}">Set as Cooling</button>
                </span>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <div>No Kasa plugs found on your network.</div>
    {% endif %}
    <a href="/temp_config" class="back-link">&larr; Back to Temperature Control Config</a>
</body>
</html>